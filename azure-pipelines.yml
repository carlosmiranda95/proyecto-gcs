trigger:
- master

pool:
  vmImage: ubuntu-18.04

variables:
- group: InfoServers

steps:
- script: sudo apt-get update -y
  displayName: 'Actualizar Repositorio'

- script: sudo apt-get install default-jre -y
  displayName: 'Instalar Java'

#- script: sudo apt-get install openssh-server -y
#  displayName: 'Instalar openssh'
- script: sbt test
  displayName: 'Correr Pruebas Unitarias'
  
- script: |
          sudo apt-get update -y
          sudo apt-get install apt-transport-https ca-certificates curl software-properties-common
          curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
          sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu  $(lsb_release -cs)  stable" 
          sudo apt-get update -y
          sudo apt-get install docker-ce
          sudo systemctl start docker
  displayName: 'Instalar Docker'
  
- script: sudo docker run -d -e POSTGRES_PASSWORD=gcs -e POSTGRES_USER=gcs -e POSTGRES_DB=gcs -p 127.0.0.1:5432:5432  postgres:9.5
  displayName: 'Ejecutar Contenedor DataBase'

- script: sbt "project gcsAppIT" test
  displayName: 'Ejecutar Pruebas de Integracion'